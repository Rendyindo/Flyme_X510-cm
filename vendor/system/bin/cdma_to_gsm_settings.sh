#!/sbin/sh
#
# Patch CDMA to GSM for Android Global Phones v 4.2.7
# Build: 25/04/2016 14:34
# by Mentor - www.internauta37.altervista.org
# internauta37@altervista.org
#
# If you are editing this file adding any line please inform me so as not to waste information and in this way I can update the patch.
#
cp /system/build.prop /system/build.prop.bak
sed -i 's/\ =/=/g' /system/build.prop
sed -i 's/=\ /=/g' /system/build.prop
androidversion=$(sed -n 's/^ro.build.version.sdk=//p' /system/build.prop)
sed -i 's/# autogenerated by buildinfo.sh/# edited for GSM network by Patch CDMA to GSM for Android Global Phones v4.2.7 by Mentor - www.internauta37.altervista.org/g' /system/build.prop
# General GSM Settings
sed -i '/^cdma_ril.libpath=.*/s/^/#/' /system/build.prop
sed -i '/^DEVICE_PROVISIONED=.*/s/^/#/' /system/build.prop
sed -i '/^lte_ril.libpath=.*/s/^/#/' /system/build.prop
sed -i '/^lte_ril.netcfg_to=.*/s/^/#/' /system/build.prop
sed -i 's/^persist.radio.ap.phonetype=2/persist.radio.ap.phonetype=1/g' /system/build.prop
sed -i '/^persist.radio.eons.enabled=.*/s/^/#/' /system/build.prop
sed -i '/^persist.radio.fill_eons=.*/s/^/#/' /system/build.prop
sed -i '/^persist.radio.lte.mm.disable=.*/s/^/#/' /system/build.prop
sed -i '/^persist.radio.mode_pref_nv10=.*/s/^/#/' /system/build.prop
sed -i '/^persist.radio.vzw.cdma.mdn=.*/s/^/#/' /system/build.prop
sed -i 's/^persist.ril.features=0x90A/persist.ril.features=0x102/g' /system/build.prop
sed -i 's/^persist.ril.modem.mode=1/persist.ril.modem.mode=2/g' /system/build.prop
sed -i 's/^persist.ril.mux.noofchannels=8/persist.ril.mux.noofchannels=10/g' /system/build.prop
sed -i '/^ril.rat=.*/s/^/#/' /system/build.prop
sed -i '/^ril.subscription.types=.*/s/^/#/' /system/build.prop
sed -i '/^ro.cdma.data_retry_config=.*/s/^/#/' /system/build.prop
sed -i '/^ro.cdma.home.operator.alpha=.*/s/^/#/' /system/build.prop
sed -i '/^ro.cdma.home.operator.isnan=.*/s/^/#/' /system/build.prop
sed -i '/^ro.cdma.home.operator.numeric=.*/s/^/#/' /system/build.prop
sed -i '/^ro.cdma.homesystem=.*/s/^/#/' /system/build.prop
sed -i '/^ro.cdma.nbpcd=.*/s/^/#/' /system/build.prop
sed -i '/^ro.cdma.otaspnumschema=.*/s/^/#/' /system/build.prop
sed -i '/^ro.cdma.subscribe_on_ruim_ready=.*/s/^/#/' /system/build.prop
sed -i '/^ro.cdma.subscription=.*/s/^/#/' /system/build.prop
sed -i 's/^ro.com.android.dataroaming=true/ro.com.android.dataroaming=false/g' /system/build.prop
sed -i 's/^ro.config.multimode_cdma=1/ro.config.multimode_cdma=0/g' /system/build.prop
sed -i 's/^ro.config.multimode_cdma=true/ro.config.multimode_cdma=false/g' /system/build.prop
sed -i '/^ro.config.svdo=.*/s/^/#/' /system/build.prop
sed -i '/^ro.config.svlte1x=.*/s/^/#/' /system/build.prop
sed -i 's/^ro.radio.networkmode=disable/ro.radio.networkmode=enable/g' /system/build.prop
sed -i '/^ro.ril.svlte1x=.*/s/^/#/' /system/build.prop
sed -i '/^ro.telephony.default_cdma_sub=.*/s/^/#/' /system/build.prop
sed -i 's/^ro.telephony.gsm-routes-us-smsc=1/ro.telephony.gsm-routes-us-smsc=0/g' /system/build.prop
sed -i '/^ro.telephony.get_imsi_from_sim=.*/s/^/#/' /system/build.prop
sed -i 's/^ro.telephony.ril.config=.*/ro.telephony.ril.config=writeaidonly\,signalstrength/g' /system/build.prop
sed -i 's/^ro.telephony.ril.v3=.*/ro.telephony.ril.v3=writeaidonly\,signalstrength/g' /system/build.prop
sed -i '/^telephony.lte.cdma.device=.*/s/^/#/' /system/build.prop
sed -i '/^telephony.lteOnCdmaDevice=.*/s/^/#/' /system/build.prop
sed -i '/^telephony.lteOnGsmDevice=.*/s/^/#/' /system/build.prop
sed -i '/^telephony.rilV7NeedCDMALTEPhone=.*/s/^/#/' /system/build.prop
sed -i '/^telephony.sms.pseudo_multipart=.*/s/^/#/' /system/build.prop
# Conditional Settings
if grep '^ro.telephony.default_network' /system/build.prop > /dev/null ;
then
	sed -i 's/^ro.telephony.default_network=.*/ro.telephony.default_network=3/g' /system/build.prop
else
	sed -i '1,/^$/{
	/^$/a\ro.telephony.default_network=3
	}' /system/build.prop
fi
if grep '^ro.ril.def.preferred.network' /system/build.prop > /dev/null ;
then
	sed -i 's/^ro.ril.def.preferred.network=.*/ro.ril.def.preferred.network=3/g' /system/build.prop
else
	sed -i '/^ro.telephony.default_network=.*/a\ro.ril.def.preferred.network=3' /system/build.prop
fi
if grep '^persist.sys.report_gprs_as_edge' /system/build.prop > /dev/null ;
then
	sed -i 's/^persist.sys.report_gprs_as_edge=.*/persist.sys.report_gprs_as_edge=1/g' /system/build.prop
else
	sed -i '/^ro.ril.def.preferred.network=.*/a\persist.sys.report_gprs_as_edge=1' /system/build.prop
fi
if grep '^ro.gsm.data_retry_config' /system/build.prop > /dev/null ;
then
	sed -i 's/^ro.gsm.data_retry_config=.*/ro.gsm.data_retry_config=default_randomization=2000\,max_retries=infinite\,1000\,1000\,80000\,125000\,485000\,905000/g' /system/build.prop
else
	sed -i '/^persist.sys.report_gprs_as_edge=.*/a\ro.gsm.data_retry_config=default_randomization=2000\,max_retries=infinite\,1000\,1000\,80000\,125000\,485000\,905000' /system/build.prop
fi
if grep '^ro.gsm.2nd_data_retry_config' /system/build.prop > /dev/null ;
then
	sed -i 's/^ro.gsm.2nd_data_retry_config=.*/ro.gsm.2nd_data_retry_config=max_retries=1\,15000/g' /system/build.prop
else
	sed -i '/^ro.gsm.data_retry_config=.*/a\ro.gsm.2nd_data_retry_config=max_retries=1\,15000' /system/build.prop
fi
if ! grep '^ro.telephony.ril.v3' /system/build.prop > /dev/null && ! grep '^ro.telephony.ril.config' /system/build.prop > /dev/null ;
then
	if [ $androidversion -le '19' ]
		then
			sed -i '/^ro.gsm.2nd_data_retry_config=.*/a\ro.telephony.ril.v3=writeaidonly\,signalstrength' /system/build.prop
		else
			sed -i '/^ro.gsm.2nd_data_retry_config=.*/a\ro.telephony.ril.config=writeaidonly\,signalstrength' /system/build.prop
	fi
fi
# Motorola GSM Settings
sed -i 's/^rild.libpath=\/system\/lib\/moto-ril-multimode.so/#rild.libpath=\/system\/lib\/moto-ril-multimode.so/g' /system/build.prop
sed -i 's/^ro.mot.ds.fastdormancy.disable=false/ro.mot.ds.fastdormancy.disable=true/g' /system/build.prop
sed -i 's/^ro.mot.eri=1/ro.mot.eri=0/g' /system/build.prop
sed -i 's/^ro.mot.hw.HAC=0/ro.mot.hw.HAC=1/g' /system/build.prop
sed -i '/^ro.mot.lte_on_cdma=.*/s/^/#/' /system/build.prop
sed -i 's/^ro.mot.phonemode.vzwglobalphone=1/ro.mot.phonemode.vzwglobalphone=0/g' /system/build.prop
sed -i 's/^ro.mot.phonemode.vzw4gphone=1/ro.mot.phonemode.vzw4gphone=0/g' /system/build.prop
# European Settings
sed -i 's/^ro.com.android.dateformat=.*/ro.com.android.dateformat=dd-MM-yyyy/g' /system/build.prop
sed -i 's/^ro.product.locale.region=.*/ro.product.locale.region=GB/g' /system/build.prop
# Database Settings
sed -i 's/^ro.build.target_operator=.*/ro.build.target_operator=OPEN/g' /system/build.prop
sed -i 's/^ro.carrier=.*/ro.carrier=unknown/g' /system/build.prop
sed -i 's/^ro.HorizontalBUA=true/ro.HorizontalBUA=false/g' /system/build.prop
sed -i 's/^ro.HorizontalVVM=true/ro.HorizontalVVM=false/g' /system/build.prop
sed -i 's/^ro.mot.build.customerid=verizon/ro.mot.build.customerid=rtanz/g' /system/build.prop
sed -i 's/^ro.com.google.clientidbase.am=.*/ro.com.google.clientidbase.am=android-google/g' /system/build.prop
sed -i 's/^ro.com.google.clientidbase.ms=.*/ro.com.google.clientidbase.ms=android-google/g' /system/build.prop
sed -i 's/^ro.com.google.clientidbase.yt=.*/ro.com.google.clientidbase.yt=android-google/g' /system/build.prop
